#!/bin/sh
#
# cycle through wallpapers

filename=''
same='false'

# parse flags and or filename
while getopts 'sf:' flag; do
    case "${flag}" in
        s) same='true';;
        f) filename="${OPTARG}";;
    esac
done


# get filename of current wallpaper
p=$(cat $HOME/.fehbg | cut -d'/' -f7)
previous=${p::-2} # remove trailing '

if [ "$filename" = "" -a "$same" = "false" ]; then
    # if image not exclicitly specified get different random image
    filename=$(ls ~/.local/share/wallpaper/ | shuf -n 1)
    # if we choose the previously used wallpaper
    while [ $filename = $previous ]
    do
        filename=$(ls ~/.local/share/wallpaper/ | shuf -n 1)
    done
elif [ "$same" == "true" ]; then
    # if same flag is passed in dont change the wallpaper
    #
    # idk why this hack is necessary for feh to properly set the correct file but it is
    # filename=$previous would be desireable but it fails for some reason
    filename=$(echo $previous)
fi

default="$HOME/.local/share/wallpaper/"
filepath=$filename
if [ ! -f "$filename" ]; then
    # strip file path and just use basename
    # filename=$(basename $filename)

    # if not a valid path, then use default path
    filepath="$HOME/.local/share/wallpaper/$filename"
fi


if pgrep -x "Xorg" > /dev/null
then
    # set bg for X
    feh --bg-scale $filepath
else
    # set bg for Sway
    swaymsg output "*" bg $filepath fill
fi
