#!/bin/bash
#
# monitor torrent info

# check if transmission daemon is running, if not exit, if yes...
# check if transmission-remote hangs, if it does exit, if it doesn't continue
if ! pgrep -x "transmission-da" > /dev/null || ! timeout 1 transmission-remote -l > /dev/null
then
    exit 1
fi

up=$(transmission-remote -l | grep Sum | awk '{print $4}')
down=$(transmission-remote -l | grep Sum | awk '{print $5}')
stats=$(transmission-remote -l | grep % |
	sed " # The letters are for sorting and will not appear.
	s/.*Stopped.*/A ğŸ›‘/;
	s/.*Seeding.*/Z ğŸŒ±/;
	s/.*100%.*/N âœ…/;
	s/.*Idle.*/B ğŸ•°ï¸/;
	s/.*Uploading.*/L â¬†ï¸/;
	s/.*%.*/M â¬‡ï¸/" |
	sort -h | uniq -c | awk '{print $3 $1}' | paste -sd ' ' -)

if [[ $up = "0.0" && $down = "0.0" ]]; then
    echo $stats
else
    echo "Up: $up, Down: $down $stats"
fi

case $BLOCK_BUTTON in
	3) notify-send "Module shows number of torrents:
ğŸ›‘: paused
ğŸ•°: idle (seeds needed)
ğŸ”¼: uploading (unfinished)
ğŸ”½: downloading
âœ…: done
ğŸŒ±: done and seeding" ;;
        # 1) fullscreen "watch -n 1 transmission-remote -l";;
        1) fullscreen "watchless \"transmission-remote -l\" 3"
esac
